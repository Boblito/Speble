<!DOCTYPE html>
<html>
<head>
<link rel="styleSheet" href="css/spebleStyle.css">
</head>
<body>

<h1>Speble</h1>

<p id="results"></p>

<p id="advices"></p>

<select id="stableSelect" onchange="geckoRequest()">
    <option value="null" selected disabled hidden>Choose a stablecoin</option>
    <option value="ampleforth">Ampleforth</option>
    <option value="base-protocol">Base Protocol</option>
</select>

<div class="duration">
    <input type="radio" id="radio30" name="duration" onchange="geckoRequest()" value="30" checked>
    <label>Month</label><br>
    <input type="radio" id="radio365" name="duration" onchange="geckoRequest()"value="365">
    <label>Year</label>
    <input type="radio" id="radioTot" name="duration" onchange="geckoRequest()"value="10000">
    <label>Total</label>
</div>

<canvas id="graph" width="400" height="100" 
aria-label="Stablecoin value by date" role="img"></canvas>


<script src='https://unpkg.com/axios/dist/axios.min.js'></script>
<script src='https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js'></script>

<script src='scripts/testApi.js'></script>
<script src='scripts/testCharts.js'></script>

<script>

    var posIntensity;
    var negIntensity;

    function driftCalculation(v) {
        var driftPos = [];
        var driftNeg = [];

        for(let i in price) {
            if (price[i] > 1) {
                driftPos.push(price[i]);
            }
            if (price[i] < 1) {
                driftNeg.push(price[i]);
            }
        }

        console.log(driftPos);
        console.log(driftNeg);

        if(driftPos.length <= 2) {
            posIntensity = 0;
        } else {
            var posSum = 0;
            for(let i = 0; i < driftPos.length; i++) {
                posSum += driftPos[i]; 
            }
            posIntensity = posSum/driftPos.length;
        }

        if(driftNeg.length == 1) {
            negIntensity = 0;
        } else {
            var negSum = 0;
            for(let i = 0; i < driftNeg.length; i++) {
                negSum += driftNeg[i]; 
            }
            negIntensity = negSum/driftNeg.length;
        }
        
        document.getElementById("results").innerHTML = "Positive Intensity = " + Number.parseFloat(posIntensity).toPrecision(4) + "<br>" + "Negative Intensity = " 
        + Number.parseFloat(negIntensity).toPrecision(4) + "<br>" + " Actual Value = " + Number.parseFloat(v).toPrecision(4);
    }

    function advice(v){
        var s;

        if(v >= 1) {
            s = "You are in a positive drift";
            if (v <= posIntensity) {
                if(((v-1)/(posIntensity-1)) <= 0.5) {
                    s += ", it is advisable to sell ðŸ“‰";
                } else {
                    s += ", it is strongly advised to sell ðŸ“‰";
                }
            } else {
                s += ", it is necessary to sell immediately ðŸ“‰";
            }
        } else {
            s = "You are in a negative drift";
            if (v >= negIntensity) {
                if (((1-v)/(1-negIntensity) <= 0.5)) {
                    s += ", it is advisable to buy ðŸ“ˆ";
                } else {
                    s += ", it is strongly advised to buy ðŸ“ˆ";
                }
            } else {
                s += ", it is necessary to buy immediately ðŸ“ˆ";
            }
        }
        document.getElementById("advices").innerHTML = s;
    }

</script>

</body>
</html> 

